<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=theme-color content="dark"><title>初めての vim プラグイン作成 | cat2koban.dev</title><link rel=icon type=image/png href=/images/favicon.png><link rel=stylesheet href=/sass/main.min.d85b5bcbf9dc35a77a2339044932e9574cf986dbee3feb73f5c82f0d2f05e703.css><meta property="og:url" content="https://cat2koban.dev/posts/2020-12-08/"><meta property="og:type" content="article"><meta property="og:site_name" content="cat2koban.dev"><meta property="og:title" content="初めての vim プラグイン作成"><meta property="og:description" content="この記事は Vim2 Advent Calendar 2020 - Qiita の8日目の記事です。昨日は Hasu さんの 高校生がVimプラグインを作った話 でした。
はじめにこの記事では、アルパカ隊長 さんに教わりながら作成した はじめての Vim プラグイン作成の話を書きたいと思います。
作ったものgithub.com
複数行選択をしたのちに、 :Ghlink とコマンドを入力すると、選択した行がハイライトされたページへのリンクがクリップボードに保存される、と言うものです。
vim-plug の場合は、vim の設定ファイルに以下の通りに記述するとインストールされると思います。
"><meta property="og:image" content="https://cat2koban.dev/tcard/2020-12-08.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@cat2koban"></head><body class=dark><nav class=navbar><div class=container><div class=flex><div><a class=brand href=/>cat2koban.dev</a></div><button id=dark-mode-button></button></div></div><div class=container><div class=header-links><u><a class=header-link href=/about/>About</a></u>
<u><a class=header-link href=/index.xml>RSS</a></u>
<u><a class=header-link href=/tags/>Tags</a></u></div></div></nav><main><div class=container><article><header class=article-header><div class=thumb><div><h1>初めての vim プラグイン作成</h1><div class=post-meta><div>By cat2koban on <time>December 08, 2020</time></div><div class=tags><a href=/tags/vim/>vim</a></div></div></div></div></header></article><div class=article-post><p>この記事は <a href=https://qiita.com/advent-calendar/2020/vim2>Vim2 Advent Calendar 2020 - Qiita</a> の8日目の記事です。
昨日は <a href=https://qiita.com/7321hasu>Hasu</a> さんの <a href=https://qiita.com/7321hasu/items/d44e272dccaf38ff9b20>高校生がVimプラグインを作った話</a> でした。</p><h3>はじめに</h2><p>この記事では、<a href=https://twitter.com/alpaca_tc>アルパカ隊長</a> さんに教わりながら作成した はじめての Vim プラグイン作成の話を書きたいと思います。</p><h3>作ったもの</h3><p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fgithub.com%2Fcat2koban%2Fghlink.vim" title=cat2koban/ghlink.vim class="embed-card embed-webcard" scrolling=no frameborder=0 style="display:block;width:100%;height:155px;max-width:500px;margin:10px 0"></iframe><cite class=hatena-citation><a href=https://github.com/cat2koban/ghlink.vim>github.com</a></cite></p><p>複数行選択をしたのちに、 <code>:Ghlink</code> とコマンドを入力すると、選択した行がハイライトされたページへのリンクがクリップボードに保存される、と言うものです。</p><p>vim-plug の場合は、vim の設定ファイルに以下の通りに記述するとインストールされると思います。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl> <span class=nx>Plug</span> <span class=s2>&#34;cat2koban/ghlink.vim&#34;</span>;<span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>簡単なデモを下に載せておきます。</p><p><figure class="figure-image figure-image-fotolife" title=ghlink.vim_demo><span itemscope itemtype=http://schema.org/Photograph><img src=https://cdn-ak.f.st-hatena.com/images/fotolife/s/sorehaedamame/20201208/20201208095052.gif alt=f:id:sorehaedamame:20201208095052g:plain title class=hatena-fotolife itemprop=image></span></figure></p><p>選択した後に <code>:</code> を押すと、コマンド入力部分に既に <code>'&lt;,'></code> が入力されていると思いますが、続けて <code>Ghlink</code> と打ちます。</p><p>もともと Slack などで質問する際に、複数行ハイライトされた状態のページへのリンクをさくっと取得できるようにしたいなと思ってこう言うプラグインを作ろうと思いました。
まぁ特に調べもせずに、Vimプラグインがどういうふうに作られるのか気になっていたので、車輪の再発明は気にせず学び目的で作成しました。
まだいくつか TODO が残っているので、引き続き実装は進めていこうと考えています。</p><h3>作るときに便利だったもの</h3><p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fgithub.com%2Fvim-jp%2Fvital.vim" title=vim-jp/vital.vim class="embed-card embed-webcard" scrolling=no frameborder=0 style="display:block;width:100%;height:155px;max-width:500px;margin:10px 0"></iframe><cite class=hatena-citation><a href=https://github.com/vim-jp/vital.vim>github.com</a></cite></p><p>便利関数が多数定義されているプラグイン。これからのプラグイン開発では、こいつは必須になってくるのかなぁと思った代物です。ghlink.vim のコードでもその定義された関数を使っていて、便利さを 1行で実感しました。
2行目の <code>s:Prelude.path2project_directory(a:path)</code> の部分が vital の中で定義された関数を呼び出している箇所になります。
とはいえ実際の上の行では vital のインスタンスを作成していたりと、vital の関数を使う前にいくつかすることがあるのですが、それはドキュメントを参照してください。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl> <span class=k>function</span><span class=p>!</span> <span class=nx>s</span>:<span class=nx>current_git_path</span><span class=p>(</span><span class=nx>path</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>   <span class=k>let</span> <span class=nx>git_root</span> <span class=p>=</span> <span class=nx>s</span>:<span class=nx>Prelude</span>.<span class=nx>path2project_directory</span><span class=p>(</span><span class=nx>a</span>:<span class=nx>path</span><span class=p>)</span> <span class=c>&#34; ここで .git の管理するルートディレクトリからの現在のファイルパスを読み込んでいる</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>   <span class=nx>return</span> <span class=nx>substitute</span><span class=p>(</span><span class=nx>a</span>:<span class=nx>path</span><span class=p>,</span> <span class=nx>git_root</span>.<span class=s2>&#34;/&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=s2>&#34;g&#34;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span> <span class=k>endfunction</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>ref: <a href=https://github.com/cat2koban/ghlink.vim/blob/2be9505c1568c18c47335fc99fabe4325dfffe10/autoload/ghlink.vim#L16-L19>github.com/cat2koban/ghlink.vim/blob/&mldr;/autoload/ghlink.vim#L16-19</a></p><h3>おわりに</h3><p>自分の中で課題と感じていることを、自分で作ったプラグインで解決する、という経験がなかったので、楽しみながら作ることができました。<a href=https://twitter.com/alpaca_tc>アルパカ隊長</a> さんには細かくご教示いただけて、とても感謝しています。あらかたプラグインを作る上での最低限のフォーマットは抑えられたのかなと思っているので、次は TODO をつぶしつつ、新しプラグインの作成にも目を向けても面白いかもなと思っています。</p></div></div><div class=container><nav class="flex container suggested"><a rel=prev href=/posts/2020-08-30/ title="Previous post (older)"><span>Previous</span>
vim-startify に indent line をつけないようにする</a>
<a rel=next href=/posts/2020-12-13/ title="Next post (newer)"><span>Next</span>
少しだけ新卒を振り返る猫</a></nav></div></main></main><footer class="footer flex"><section class=container><nav class=footer-links></nav></section><script async src=/js/features.min.998e7aa76795e443649151776dfe12dc53c3a3dfff300ce31b7e1d0e5b12894d.js></script></footer></body></html>